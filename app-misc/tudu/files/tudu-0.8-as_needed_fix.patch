From fe7424cdb3f8d418092f318b4381e9a5f1f74a2b Mon Sep 17 00:00:00 2001
From: James Rowe <jnrowe@gmail.com>
Date: Sat, 8 Jan 2011 09:16:56 +0000
Subject: [PATCH] --as-needed fix.

No, I don't like patching generated files but the build system in use isn't
packaged so this is the lazy way out.

Signed-off-by: James Rowe <jnrowe@gmail.com>
---
 configure        |    6 +++---
 src/Makefile.acr |    3 ++-
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/configure b/configure
index 440e600..f3688cf 100755
--- a/configure
+++ b/configure
@@ -242,7 +242,7 @@ parse_options $1
 shift
 done
 
-ENVWORDS="MANDIR INFODIR LIBDIR INCLUDEDIR LOCALSTATEDIR SYSCONFDIR DATADIR LIBEXECDIR SBINDIR BINDIR EPREFIX PREFIX SPREFIX TARGET HOST BUILD INSTALL INSTALL_LIB INSTALL_MAN INSTALL_PROGRAM INSTALL_DIR INSTALL_SCRIPT INSTALL_DATA HOST_OS HOST_CPU BUILD_OS BUILD_CPU TARGET_OS TARGET_CPU PKGNAME VPATH VERSION CONTACT CONTACT_NAME CONTACT_MAIL YEAR CXX CXXFLAGS LDFLAGS HAVE_LANG_CXX CPP SRCS HAVE_XCURSES_H HAVE_NCURSESW_CURSES_H HAVE_NCURSES_CURSES_H HAVE_NCURSES_H HAVE_CURSES_H CURSES_INCLUDE HAVE_LIB_NCURSESW HAVE_LIB_NCURSES HAVE_LIB_CURSES LD_CURSES WIDEC_CURSES HAVE_STRING HAVE_VECTOR HAVE_MAP HAVE_FSTREAM HAVE_LIST HAVE_STACK HAVE_ALGORITHM HAVE_SET HAVE_CTIME HAVE_CSTRING HAVE_CSIGNAL HAVE_CSTDIO HAVE_CSTDLIB HAVE_SYS_TYPES_H HAVE_SYS_WAIT_H HAVE_SYS_STAT_H HAVE_UNISTD_H HAVE_FCNTL_H HAVE_LOCALE HAVE_CWCHAR HAVE_CLOCALE HAVE_CLIMITS HAVE_IOSTREAM HAVE_IOMANIP HAVE_SSTREAM HAVE_CERRNO"
+ENVWORDS="MANDIR INFODIR LIBDIR INCLUDEDIR LOCALSTATEDIR SYSCONFDIR DATADIR LIBEXECDIR SBINDIR BINDIR EPREFIX PREFIX SPREFIX TARGET HOST BUILD INSTALL INSTALL_LIB INSTALL_MAN INSTALL_PROGRAM INSTALL_DIR INSTALL_SCRIPT INSTALL_DATA HOST_OS HOST_CPU BUILD_OS BUILD_CPU TARGET_OS TARGET_CPU PKGNAME VPATH VERSION CONTACT CONTACT_NAME CONTACT_MAIL YEAR CXX CXXFLAGS LDFLAGS HAVE_LANG_CXX CPP SRCS HAVE_XCURSES_H HAVE_NCURSESW_CURSES_H HAVE_NCURSES_CURSES_H HAVE_NCURSES_H HAVE_CURSES_H CURSES_INCLUDE HAVE_LIB_NCURSESW HAVE_LIB_NCURSES HAVE_LIB_CURSES LD_CURSES WIDEC_CURSES HAVE_STRING HAVE_VECTOR HAVE_MAP HAVE_FSTREAM HAVE_LIST HAVE_STACK HAVE_ALGORITHM HAVE_SET HAVE_CTIME HAVE_CSTRING HAVE_CSIGNAL HAVE_CSTDIO HAVE_CSTDLIB HAVE_SYS_TYPES_H HAVE_SYS_WAIT_H HAVE_SYS_STAT_H HAVE_UNISTD_H HAVE_FCNTL_H HAVE_LOCALE HAVE_CWCHAR HAVE_CLOCALE HAVE_CLIMITS HAVE_IOSTREAM HAVE_IOMANIP HAVE_SSTREAM HAVE_CERRNO LD_CURSES"
 
 create_environ
 
@@ -348,9 +348,9 @@ if [ "$HAVE_LIB_CURSES" = "1" ]; then
 [ -z "${LD_CURSES}" ]  && LD_CURSES="-lcurses"; fi
 if [ "$LD_CURSES" = "" ]; then
 case "$undefined_variable" in 0|"") echo ; echo "ERROR: There is no curses installed!" >&2 ; echo ; exit 1 ;; esac; fi
-LDFLAGS="${LDFLAGS} $LD_CURSES"
+LDFLAGS="${LDFLAGS}"
 printf "checking for WIDEC_CURSES... "
-echo "#define _XOPEN_SOURCE_EXTENDED" > test.c  ; echo "#include<$CURSES_INCLUDE>" >> test.c  ; echo "main(){ addwstr(L\"\"); }" >> test.c  ; eval \$${COMPILER} ${CXXFLAGS} ${LDFLAGS} test.c >/dev/null 2>&1  ; if [ $? = 0 ]; then WIDEC_CURSES=1; else WIDEC_CURSES=0; fi  ; rm test.c 
+echo "#define _XOPEN_SOURCE_EXTENDED" > test.c  ; echo "#include<$CURSES_INCLUDE>" >> test.c  ; echo "main(){ addwstr(L\"\"); }" >> test.c  ; eval \$${COMPILER} ${CXXFLAGS} ${LDFLAGS} test.c $LD_CURSES >/dev/null 2>&1  ; if [ $? = 0 ]; then WIDEC_CURSES=1; else WIDEC_CURSES=0; fi  ; rm test.c 
 if [ "$WIDEC_CURSES" = 1 ]; then
 	echo yes
 else
diff --git a/src/Makefile.acr b/src/Makefile.acr
index 5e4a611..0a04312 100644
--- a/src/Makefile.acr
+++ b/src/Makefile.acr
@@ -6,6 +6,7 @@ INSTALL_PROGRAM=@INSTALL_PROGRAM@
 CXX=@CXX@
 CXXFLAGS=@CXXFLAGS@
 LDFLAGS=@LDFLAGS@
+LD_CURSES=@LD_CURSES@
 SRCS=@SRCS@
 
 prefix=@PREFIX@
@@ -17,7 +18,7 @@ OBJS=$(SRCS:.cc=.o)
 all: $(PKGNAME)
 
 $(PKGNAME): $(OBJS)
-	$(CXX) $(CXXFLAGS) $(LDFLAGS) -o $@ $(OBJS)
+	$(CXX) $(CXXFLAGS) $(LDFLAGS) -o $@ $(OBJS) $(LD_CURSES)
 
 .cc.o:
 	$(CXX) $(CXXFLAGS) -c $<
-- 
1.7.3.4

