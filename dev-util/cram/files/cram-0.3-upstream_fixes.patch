--- a/cram.py	Sun Sep 19 17:57:17 2010 -0500
+++ b/cram.py	Wed Sep 22 00:21:58 2010 -0400
@@ -80,7 +80,7 @@
             after.setdefault(pos, []).append(line)
             prepos = pos
             pos = i
-            p.stdin.write('echo "\\n%s %s $?"\n' % (salt, i))
+            p.stdin.write('echo "\n%s %s $?"\n' % (salt, i))
             p.stdin.write(line[4:])
         elif line.startswith('  > '):
             after.setdefault(prepos, []).append(line)
@@ -89,7 +89,7 @@
             expected.setdefault(pos, []).append(line[2:])
         else:
             after.setdefault(pos, []).append(line)
-    p.stdin.write('echo "\\n%s %s $?"\n' % (salt, i + 1))
+    p.stdin.write('echo "\n%s %s $?"\n' % (salt, i + 1))
 
     pos = -1
     ret = 0
--- a/examples/test.t	Sun Sep 19 17:57:17 2010 -0500
+++ b/examples/test.t	Wed Sep 22 00:21:58 2010 -0400
@@ -2,7 +2,7 @@
 
   $ echo foo
   foo
-  $ echo 'bar\nbaz' | cat
+  $ printf 'bar\nbaz\n' | cat
   bar
   baz
 
--- a/tests/cram.t	Sun Sep 19 17:57:17 2010 -0500
+++ b/tests/cram.t	Wed Sep 22 00:21:58 2010 -0400
@@ -8,7 +8,7 @@
   > else
   >   alias cram="$PYTHON cram.py"
   > fi
-  $ command -v md5 || alias md5=md5sum
+  $ command -v md5 > /dev/null || alias md5=md5sum
 
 Usage:
 
@@ -30,6 +30,9 @@
   $ cram -y -n
   options -y and -n are mutually exclusive
   [2]
+  $ cram non-existent also-not-here
+  no such file: non-existent
+  [2]
 
 Run cram examples:
 
@@ -219,15 +222,18 @@
   [2]
   $ mkdir foobarbaz
   $ chmod -x foobarbaz
-  $ cram -D foobarbaz xamples
+  $ cram -D foobarbaz examples
   can't change directory: Permission denied
   [2]
   $ rmdir foobarbaz
 
 Don't sterilize environment:
 
+Note: We can't set LC_ALL=foo because on systems where /bin/sh is
+bash, bash will print out warning messages about the locale being
+invalid.
+
   $ LANG=foo; export LANG
-  $ LC_ALL=foo; export LC_ALL
   $ LANGUAGE=foo; export LANGUAGE
   $ TZ=foo; export TZ
   $ CDPATH=foo; export CDPATH
@@ -244,8 +250,7 @@
   -  C
   +  foo
      $ echo "$LC_ALL"
-  -  C
-  +  foo
+     C
      $ echo "$LANGUAGE"
   -  C
   +  foo
